{% extends "base.html" %}
{% block title %}Admin - Dashboard{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 py-8">
    <div class="flex items-center justify-between mb-8">
        <h1 class="text-2xl font-bold text-gray-800">Wahlen verwalten</h1>
        <a href="{{ url_for('admin_logout') }}" class="text-sm text-gray-500 hover:text-gray-700">Abmelden</a>
    </div>

    <!-- Neue Wahl erstellen -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-8">
        <h2 class="text-lg font-semibold text-gray-700 mb-4">Neue Wahl erstellen</h2>
        <form method="POST" action="{{ url_for('admin_election_new') }}" class="flex flex-wrap gap-3 items-end">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="flex-1 min-w-[200px]">
                <label class="block text-sm text-gray-500 mb-1">Name</label>
                <input type="text" name="name" required placeholder="z.B. SchÃ¼lersprecherwahl"
                    class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none">
            </div>
            <div class="flex-1 min-w-[200px]">
                <label class="block text-sm text-gray-500 mb-1">Schulname</label>
                <input type="text" name="school_name" required placeholder="z.B. Realschule Bobingen"
                    class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none">
            </div>
            <div class="w-28">
                <label class="block text-sm text-gray-500 mb-1">Jahr</label>
                <input type="number" name="year" required value="2026"
                    class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none">
            </div>
            <div class="w-28">
                <label class="block text-sm text-gray-500 mb-1">Max. Stimmen</label>
                <input type="number" name="max_votes" value="3" min="1" max="10"
                    class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none">
            </div>
            <button type="submit"
                class="bg-blue-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-blue-700 transition">
                Erstellen
            </button>
        </form>
    </div>

    <!-- Bestehende Wahlen -->
    {% if elections %}
    <div class="space-y-4">
        {% for election in elections %}
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-5">
            <div class="flex items-center justify-between flex-wrap gap-3">
                <div>
                    <h3 class="text-lg font-semibold text-gray-800">{{ election.name }}</h3>
                    <p class="text-sm text-gray-500">
                        {{ election.year }} &middot;
                        Max. {{ election.max_votes }} Stimmen &middot;
                        {{ election.candidates|length }} Kandidaten &middot;
                        {{ election.voting_codes|length }} Codes
                        {% if election.is_active %}
                        <span class="inline-block ml-2 px-2 py-0.5 bg-green-100 text-green-700 text-xs font-semibold rounded-full animate-pulse-green">AKTIV</span>
                        {% endif %}
                    </p>
                </div>
                <div class="flex gap-2">
                    <a href="{{ url_for('admin_election', election_id=election.id) }}"
                        class="px-4 py-2 text-sm font-medium text-blue-600 border border-blue-200 rounded-lg hover:bg-blue-50 transition">
                        Bearbeiten
                    </a>
                    <a href="{{ url_for('admin_codes', election_id=election.id) }}"
                        class="px-4 py-2 text-sm font-medium text-gray-600 border border-gray-200 rounded-lg hover:bg-gray-50 transition">
                        Codes
                    </a>
                    <a href="{{ url_for('admin_results', election_id=election.id) }}"
                        class="px-4 py-2 text-sm font-medium text-gray-600 border border-gray-200 rounded-lg hover:bg-gray-50 transition">
                        Ergebnisse
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p class="text-center text-gray-400 py-12">Noch keine Wahlen vorhanden.</p>
    {% endif %}
</div>
{% endblock %}
